import pandas as pd

# Load your data (replace with your actual file path)
file_path = "your_file.csv"
df = pd.read_csv(file_path)

# Step 1: Define a function to assign positive or negative sign based on the 'Direction' column
def apply_sign(row):
    if row['Direction'] == 'DEL':
        return row['Amount USD']
    elif row['Direction'] == 'REC':
        return -row['Amount USD']
    else:
        return 0

# Step 2: Apply the function to create a new column 'Signed Amount USD'
df['Signed Amount USD'] = df.apply(apply_sign, axis=1)

# Step 3: Calculate netting opportunities based on the 'net' column

# For 'net' = 'n'
net_n_opportunities = df[df['net'] == 'n'].groupby('Unique')['Signed Amount USD'].sum().reset_index()
net_n_opportunities.columns = ['Unique', 'Netting Opportunity USD (n)']

# For 'net' = 'nn'
net_nn_opportunities = df[df['net'] == 'nn'].groupby('Unique')['Signed Amount USD'].sum().reset_index()
net_nn_opportunities.columns = ['Unique', 'Netting Opportunity USD (nn)']

# Step 4: Merge the results for comparison
comparison_netting_opportunities = pd.merge(net_n_opportunities, net_nn_opportunities, on='Unique', how='outer')

# Step 5: Display the results
print("Comparison of Netting Opportunities (n and nn):")
print(comparison_netting_opportunities)

# Optionally, save the results to a CSV file for further analysis
comparison_netting_opportunities.to_csv('netting_opportunities_comparison_n_nn.csv', index=False)
