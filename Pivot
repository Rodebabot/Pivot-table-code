import pandas as pd
import os

# Define the directory containing your Excel files
directory = 'path_to_your_directory'

# Initialize an empty DataFrame to store the appended results
all_data = pd.DataFrame()

# Loop through each Excel file in the directory
for filename in os.listdir(directory):
    if filename.endswith('.xlsx'):
        # Construct the full file path
        file_path = os.path.join(directory, filename)
        
        # Load the sheet into a DataFrame
        df = pd.read_excel(file_path, sheet_name='Netting_Benefit')
        
        # Extract the date from the 4th column header
        date = df.columns[3]
        
        # Group by CCY and sum the values in the 5th column (E)
        df_sum = df.groupby('CCY')[df.columns[4]].sum().reset_index()
        
        # Create a new DataFrame with the date and summed values
        output_df = pd.DataFrame({
            'Date': date,
            'CCY': df_sum['CCY'],
            'Sum': df_sum[df.columns[4]]
        })
        
        # Append the results to the overall DataFrame
        all_data = pd.concat([all_data, output_df])

# Save the combined DataFrame to a single Excel file
output_file_path = os.path.join(directory, 'CCY_Summary_Combined.xlsx')
all_data.to_excel(output_file_path, index=False)
